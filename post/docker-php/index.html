<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8" />

  
  <title>Docker化PHP环境</title>

  
  
  <link href="//cdn.jsdelivr.net" rel="dns-prefetch">
  <link href="//cdnjs.cloudflare.com" rel="dns-prefetch">
  <link href="//at.alicdn.com" rel="dns-prefetch">
  <link href="//fonts.googleapis.com" rel="dns-prefetch">
  <link href="//fonts.gstatic.com" rel="dns-prefetch">
  <link href="///disqus.com" rel="dns-prefetch">
  <link href="//c.disquscdn.com" rel="dns-prefetch">
  
  
  <link href="//hm.baidu.com" rel="dns-prefetch">

  

  
  <meta name="author" content="opso">
  <meta name="description" content=" Docker作为一项最流行的虚拟化技术，从2013年发展至今，已经发展的如火如荼。Docker 使用 Google 公司推出的 Go 语言 进行开发实现，基于 Linux 内核的 cgroup，namespace，以及 AUFS 类的 Union FS 等技术，对进程进行封装隔离，属于 操作系统层面的虚拟化技术。由于隔离的进程独立于宿主和其它的隔离的进程，因此也称其为容器。
">

  
  
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@gohugoio">
    <meta name="twitter:title" content="Docker化PHP环境">
    <meta name="twitter:description" content=" Docker作为一项最流行的虚拟化技术，从2013年发展至今，已经发展的如火如荼。Docker 使用 Google 公司推出的 Go 语言 进行开发实现，基于 Linux 内核的 cgroup，namespace，以及 AUFS 类的 Union FS 等技术，对进程进行封装隔离，属于 操作系统层面的虚拟化技术。由于隔离的进程独立于宿主和其它的隔离的进程，因此也称其为容器。
">
    <meta name="twitter:image" content="/images/avatar.png">
  

  
  <meta property="og:type" content="article">
  <meta property="og:title" content="Docker化PHP环境">
  <meta property="og:description" content=" Docker作为一项最流行的虚拟化技术，从2013年发展至今，已经发展的如火如荼。Docker 使用 Google 公司推出的 Go 语言 进行开发实现，基于 Linux 内核的 cgroup，namespace，以及 AUFS 类的 Union FS 等技术，对进程进行封装隔离，属于 操作系统层面的虚拟化技术。由于隔离的进程独立于宿主和其它的隔离的进程，因此也称其为容器。
">
  <meta property="og:url" content="/post/docker-php/">
  <meta property="og:image" content="/images/avatar.png">




<meta name="generator" content="Hugo 0.51">


<link rel="canonical" href="/post/docker-php/">

<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="format-detection" content="telephone=no,email=no,adress=no">
<meta http-equiv="Cache-Control" content="no-transform">


<meta name="robots" content="index,follow">
<meta name="referrer" content="origin-when-cross-origin">







<meta name="theme-color" content="#02b875">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="opso&#39;s Blog">
<meta name="msapplication-tooltip" content="opso&#39;s Blog">
<meta name='msapplication-navbutton-color' content="#02b875">
<meta name="msapplication-TileColor" content="#02b875">
<meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
<link rel="icon" sizes="192x192" href="/icons/icon-192x192.png">
<link rel="apple-touch-icon" href="/icons/icon-152x152.png">
<link rel="manifest" href="/manifest.json">


<link rel="preload" href="/styles/main.min.css" as="style">
<link rel="preload" href="https://fonts.googleapis.com/css?family=Lobster" as="style">
<link rel="preload" href="/images/avatar.png" as="image">
<link rel="preload" href="/images/grey-prism.svg" as="image">


<style>
  body {
    background: rgb(244, 243, 241) url('/images/grey-prism.svg') repeat fixed;
  }
</style>
<link rel="stylesheet" href="/styles/main.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lobster">



<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.2/dist/medium-zoom.min.js"></script>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/video.js@7.3.0/dist/video-js.min.css">



  
  
<!--[if lte IE 8]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/videojs-ie8@1.1.2/dist/videojs-ie8.min.js"></script>
<![endif]-->

<!--[if lte IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/eligrey-classlist-js-polyfill@1.2.20180112/classList.min.js"></script>
<![endif]-->


</head>
  <body>
    
    <div class="suspension">
      <a role="button" aria-label="Go to top" title="Go to top" class="to-top is-hide"><span class="icon icon-up" aria-hidden="true"></span></a>
      
        
        <a role="button" aria-label="Go to comments" title="Go to comments" class="to-comment" href="#disqus_thread"><span class="icon icon-comment" aria-hidden="true"></span></a>
        
      
    </div>
    
    
  <header class="site-header">
  <img class="avatar" src="/images/avatar.png" alt="Avatar">
  
  <h2 class="title">opso&#39;s Blog</h2>
  
  <p class="subtitle">Talk is cheap, show me the code</p>
  <button class="menu-toggle" type="button" aria-label="Main Menu" aria-expanded="false" tab-index="0">
    <span class="icon icon-menu" aria-hidden="true"></span>
  </button>

  <nav class="site-menu collapsed">
    <h2 class="offscreen">Main Menu</h2>
    <ul class="menu-list">
      
      
      
      
        <li class="menu-item
          
          
           is-active">
          <a href="/">Home</a>
        </li>
      
        <li class="menu-item
          
          
          ">
          <a href="/tags/">Tags</a>
        </li>
      
    </ul>
  </nav>
  <nav class="social-menu collapsed">
    <h2 class="offscreen">Social Networks</h2>
    <ul class="social-list"><li class="social-item">
          <a href="mailto:945206413@qq.com" title="Email" aria-label="Email">
            <span class="icon icon-email" aria-hidden="true"></span>
          </a>
        </li><li class="social-item">
          <a href="//github.com/opso-code" title="GitHub" aria-label="GitHub">
            <span class="icon icon-github" aria-hidden="true"></span>
          </a>
        </li><li class="social-item">
          <a href="//www.instagram.com/opso92" title="Instagram" aria-label="Instagram">
            <span class="icon icon-instagram" aria-hidden="true"></span>
          </a>
        </li><li class="social-item">
          <a href="//weibo.com/234920704" title="Weibo" aria-label="Weibo">
            <span class="icon icon-weibo" aria-hidden="true"></span>
          </a>
        </li></ul>
  </nav>
</header>

  <section class="main post-detail">
    <header class="post-header">
      <h1 class="post-title">Docker化PHP环境</h1>
      <p class="post-meta">@opso · Jan 29, 2018 · 3 min read</p>
    </header>
    <article class="post-content"><blockquote>
<p>Docker作为一项最流行的虚拟化技术，从2013年发展至今，已经发展的如火如荼。Docker 使用 Google 公司推出的 Go 语言 进行开发实现，基于 Linux 内核的 cgroup，namespace，以及 AUFS 类的 Union FS 等技术，对进程进行封装隔离，属于 操作系统层面的虚拟化技术。由于隔离的进程独立于宿主和其它的隔离的进程，因此也称其为容器。</p>
</blockquote>

<p><svg id="logoHorizontal" viewBox="-5.724 -43.601 2000 600" width="40%">
    <path d="M934.957,149.221c-10.479-0.345-19.253,7.869-19.599,18.348c-0.014,0.417-0.014,0.834,0,1.251v94.24
      c-45.47-36.517-111.933-29.258-148.449,16.211c-15.064,18.758-23.271,42.096-23.264,66.153
      c-0.996,58.292,45.451,106.354,103.744,107.351c58.292,0.996,106.354-45.451,107.351-103.743c0.021-1.203,0.021-2.405,0-3.607
      V168.913c0.157-5.29-1.933-10.399-5.753-14.061c-3.741-3.658-8.799-5.655-14.03-5.538 M910.158,370.839
      c-6.741,15.855-19.321,28.513-35.136,35.352c-16.569,7.015-35.274,7.015-51.844,0c-15.782-6.775-28.314-19.418-34.951-35.26
      c-6.935-16.383-6.935-34.876,0-51.258c6.651-15.789,19.187-28.368,34.951-35.075c16.569-7.015,35.274-7.015,51.844,0
      c15.814,6.839,28.395,19.495,35.136,35.352c6.933,16.319,6.933,34.755,0,51.074"></path>
    <path d="M1155.344,270.69c-41.243-41.206-108.082-41.176-149.288,0.067c-19.769,19.785-30.876,46.606-30.886,74.574
      c-0.996,58.293,45.451,106.355,103.744,107.352c58.292,0.996,106.354-45.452,107.351-103.744c0.021-1.202,0.021-2.404,0-3.607
      c0.009-13.882-2.645-27.637-7.815-40.521C1173.124,291.998,1165.265,280.393,1155.344,270.69 M1141.714,370.746
      c-3.371,7.823-8.17,14.95-14.153,21.015c-6.036,6.063-13.166,10.929-21.015,14.337c-16.558,7.017-35.254,7.017-51.812,0
      c-15.8-6.76-28.347-19.406-34.982-35.259c-6.935-16.383-6.935-34.876,0-51.259c6.67-15.765,19.218-28.312,34.982-34.982
      c16.558-7.017,35.254-7.017,51.812,0c7.849,3.408,14.979,8.273,21.015,14.338c5.983,6.063,10.782,13.19,14.153,21.014
      c6.893,16.327,6.893,34.747,0,51.074"></path>
    <path d="M1591.747,259.368c0.013-2.595-0.521-5.163-1.568-7.538c-1.066-2.279-2.513-4.36-4.277-6.154
      c-1.742-1.816-3.836-3.261-6.153-4.246c-2.448-1.01-5.073-1.522-7.723-1.508c-3.742-0.025-7.411,1.044-10.554,3.077l-112.7,73.319
      V169.097c0.1-5.27-1.982-10.347-5.753-14.03c-3.626-3.81-8.68-5.929-13.938-5.846c-10.857-0.068-19.715,8.679-19.783,19.537
      c0,0.083,0,0.165,0,0.247v261.983c-0.063,5.236,2.016,10.271,5.754,13.938c3.653,3.823,8.741,5.943,14.029,5.846
      c5.241,0.085,10.276-2.037,13.876-5.846c3.738-3.667,5.817-8.702,5.754-13.938v-67.934l22.983-15.076l87.103,97.81
      c3.528,3.393,8.275,5.223,13.168,5.076c2.65,0.03,5.278-0.483,7.723-1.508c2.322-0.962,4.418-2.397,6.153-4.215
      c1.792-1.841,3.241-3.987,4.276-6.338c1.048-2.375,1.582-4.943,1.57-7.538c0.012-5.112-1.938-10.035-5.446-13.753l-80.979-91.226
      l78.949-51.258C1589.31,271.505,1592.174,265.553,1591.747,259.368"></path>
    <path d="M1264.752,298.505c6.085-6.016,13.258-10.818,21.138-14.153c8.16-3.472,16.945-5.23,25.813-5.169
      c7.851-0.072,15.646,1.326,22.983,4.123c7.353,2.957,14.163,7.116,20.152,12.307c3.641,2.9,8.176,4.445,12.83,4.369
      c5.304,0.223,10.459-1.786,14.215-5.538c3.697-3.768,5.707-8.876,5.568-14.153c0.065-5.729-2.428-11.188-6.8-14.892
      c-18.885-16.903-43.454-26.056-68.796-25.629c-58.301,0-105.562,47.262-105.562,105.562
      c-0.146,58.216,46.929,105.527,105.145,105.674c25.412,0.063,49.992-9.056,69.214-25.679c3.965-3.773,6.192-9.019,6.153-14.491
      c0.346-10.479-7.868-19.253-18.347-19.599c-0.417-0.014-0.835-0.014-1.252,0c-4.485,0.02-8.849,1.463-12.461,4.123
      c-5.892,5.189-12.65,9.304-19.968,12.152c-7.345,2.762-15.137,4.139-22.983,4.062c-8.867,0.062-17.653-1.697-25.813-5.169
      c-7.873-3.346-15.045-8.147-21.137-14.152c-25.862-25.708-25.988-67.514-0.281-93.376c0.094-0.094,0.188-0.187,0.281-0.28"></path>
    <path d="M1983.262,252.969c-3.813-3.578-8.345-6.304-13.292-8c-5.657-2.031-11.532-3.394-17.506-4.061
      c-5.91-0.726-11.859-1.096-17.814-1.108c-12.084-0.037-24.08,2.045-35.443,6.154c-11.137,4.061-21.531,9.923-30.768,17.353v-3.938
      c-0.431-10.883-9.603-19.357-20.486-18.927c-10.279,0.406-18.521,8.647-18.927,18.927v171.897
      c0.43,10.884,9.602,19.357,20.485,18.928c10.28-0.406,18.521-8.647,18.928-18.928v-85.934c-0.059-8.877,1.699-17.673,5.168-25.844
      c3.318-7.836,8.113-14.96,14.123-20.983c6.047-6.003,13.178-10.806,21.014-14.153c8.172-3.472,16.967-5.23,25.845-5.169
      c8.825-0.087,17.587,1.511,25.813,4.707c2.599,1.251,5.427,1.953,8.308,2.062c2.649,0.024,5.276-0.489,7.723-1.508
      c2.319-0.98,4.413-2.425,6.153-4.245c1.758-1.793,3.194-3.874,4.246-6.153c1.068-2.434,1.614-5.065,1.6-7.723
      c0.191-4.952-1.732-9.751-5.291-13.2"></path>
    <path d="M1800.104,304.966c-16.765-39.188-55.187-64.69-97.81-64.919c-58.283-0.017-105.545,47.217-105.562,105.501
      c0,0.01,0,0.021,0,0.03c-0.011,58.318,47.256,105.604,105.573,105.614c25.317,0.005,49.795-9.087,68.97-25.619
      c0.277-0.276,0.708-0.646,0.77-0.738c1.719-1.392,3.222-3.029,4.461-4.861c6.336-9.125,4.076-21.658-5.045-27.998
      c-7.646-4.967-17.698-4.065-24.338,2.185c-0.646,0.585-2.492,2.308-2.799,2.554l-0.277,0.246
      c-5.617,4.777-12.033,8.526-18.953,11.076c-7.32,2.58-15.037,3.851-22.798,3.754c-7.153,0.035-14.264-1.108-21.046-3.385
      c-6.603-2.207-12.828-5.413-18.46-9.507c-5.612-4.105-10.544-9.068-14.614-14.707c-4.158-5.757-7.34-12.16-9.415-18.952h149.253
      c5.237,0.119,10.299-1.891,14.029-5.569c3.839-3.637,5.934-8.745,5.754-14.03c0.12-13.913-2.504-27.714-7.723-40.612
       M1638.729,326.041c1.972-6.798,5.094-13.208,9.229-18.952c4.095-5.648,9.059-10.612,14.707-14.707
      c5.712-4.09,12.008-7.295,18.676-9.507c6.747-2.247,13.812-3.39,20.922-3.385c7.07-0.008,14.095,1.136,20.799,3.385
      c13.307,4.422,24.901,12.887,33.167,24.214c4.221,5.737,7.445,12.145,9.538,18.952H1638.729z"></path>
    <path d="M1915.942,422.343c-7.543,0.119-13.562,6.331-13.443,13.875s6.332,13.562,13.875,13.443
      c7.495-0.118,13.494-6.254,13.445-13.75c-0.085-7.578-6.297-13.652-13.875-13.568
      C1915.944,422.343,1915.943,422.343,1915.942,422.343 M1915.942,446.741c-5.975,0.272-11.039-4.352-11.311-10.326
      c-0.271-5.976,4.352-11.04,10.327-11.312c5.975-0.271,11.039,4.352,11.311,10.327c0.009,0.19,0.013,0.382,0.011,0.573
      c0.204,5.723-4.27,10.527-9.992,10.731C1916.173,446.739,1916.058,446.741,1915.942,446.741"></path>
    <path d="M1919.081,436.342v-0.185c1.512-0.292,2.65-1.544,2.8-3.076c0.057-1.175-0.432-2.311-1.323-3.077
      c-1.445-0.765-3.076-1.106-4.707-0.984c-1.743-0.024-3.484,0.12-5.2,0.431v13.538h3.077v-5.446h1.477
      c1.754,0,2.554,0.646,2.83,2.154c0.184,1.143,0.536,2.252,1.047,3.292h3.415c-0.53-1.062-0.873-2.207-1.016-3.385
      c-0.138-1.473-1.088-2.744-2.462-3.292 M1915.296,435.327h-1.508v-3.908c0.583-0.069,1.172-0.069,1.754,0
      c1.97,0,2.893,0.831,2.893,2.062s-1.415,2-3.076,2"></path>
    <path d="M707.494,193.557c-1.938-1.539-20.029-15.199-58.181-15.199c-10.074,0.044-20.127,0.908-30.061,2.584
      c-7.384-50.612-49.228-75.288-51.104-76.395l-10.245-5.908l-6.738,9.723c-8.438,13.061-14.598,27.459-18.214,42.582
      c-6.831,28.891-2.677,56.027,11.999,79.226c-17.722,9.876-46.151,12.307-51.904,12.522H22.367
      c-12.294,0.017-22.27,9.952-22.337,22.245c-0.549,41.234,6.437,82.222,20.614,120.946c16.214,42.521,40.336,73.842,71.719,93.01
      c35.167,21.537,92.302,33.844,157.067,33.844c29.258,0.092,58.461-2.556,87.226-7.907c39.986-7.342,78.463-21.318,113.839-41.352
      c29.149-16.88,55.383-38.354,77.688-63.596c37.29-42.213,59.505-89.226,76.026-131.007c2.215,0,4.431,0,6.584,0
      c40.828,0,65.935-16.338,79.78-30.029c9.201-8.732,16.384-19.369,21.045-31.167l2.923-8.553L707.494,193.557z"></path>
    <path d="M65.995,228.909h63.073c3.042,0,5.507-2.466,5.507-5.507l0,0V167.22c0.017-3.042-2.435-5.521-5.476-5.538
      c-0.01,0-0.021,0-0.031,0H65.995c-3.042,0-5.507,2.466-5.507,5.507c0,0.01,0,0.021,0,0.031v56.181
      C60.488,226.443,62.953,228.909,65.995,228.909L65.995,228.909"></path>
    <path d="M152.913,228.909h63.073c3.042,0,5.507-2.466,5.507-5.507l0,0V167.22c0.017-3.042-2.435-5.521-5.477-5.538
      c-0.01,0-0.021,0-0.031,0h-63.073c-3.059,0-5.538,2.479-5.538,5.538v56.181C147.392,226.448,149.866,228.909,152.913,228.909"></path>
    <path d="M241.153,228.909h63.073c3.042,0,5.507-2.466,5.507-5.507l0,0V167.22c0.017-3.042-2.435-5.521-5.477-5.538
      c-0.01,0-0.021,0-0.031,0h-63.073c-3.042,0-5.507,2.466-5.507,5.507c0,0.01,0,0.021,0,0.031v56.181
      C235.646,226.443,238.112,228.909,241.153,228.909L241.153,228.909"></path>
    <path d="M328.348,228.909h63.073c3.047,0,5.521-2.46,5.538-5.507V167.22c0-3.059-2.479-5.538-5.538-5.538l0,0h-63.073
      c-3.042,0-5.507,2.466-5.507,5.507c0,0.01,0,0.021,0,0.031v56.181C322.841,226.443,325.307,228.909,328.348,228.909L328.348,228.909
      "></path>
    <path d="M152.913,148.083h63.073c3.046-0.017,5.507-2.492,5.507-5.538V86.364c0-3.042-2.466-5.507-5.507-5.507l0,0h-63.073
      c-3.046,0-5.521,2.46-5.538,5.507v56.181C147.392,145.597,149.861,148.066,152.913,148.083"></path>
    <path d="M241.153,148.083h63.073c3.046-0.017,5.507-2.492,5.507-5.538V86.364c0-3.042-2.466-5.507-5.507-5.507l0,0h-63.073
      c-3.042,0-5.507,2.466-5.507,5.507l0,0v56.181C235.646,145.591,238.107,148.066,241.153,148.083"></path>
    <path d="M328.348,148.083h63.073c3.052-0.017,5.521-2.486,5.538-5.538V86.364c-0.017-3.047-2.491-5.507-5.538-5.507h-63.073
      c-3.042,0-5.507,2.466-5.507,5.507l0,0v56.181C322.841,145.591,325.302,148.066,328.348,148.083"></path>
    <path d="M328.348,67.227h63.073c3.047,0,5.521-2.461,5.538-5.507V5.507C396.942,2.46,394.468,0,391.421,0h-63.073
      c-3.042,0-5.507,2.465-5.507,5.507l0,0v56.212C322.841,64.761,325.307,67.227,328.348,67.227"></path>
    <path d="M416.312,228.909h63.073c3.047,0,5.521-2.46,5.538-5.507V167.22c0-3.059-2.479-5.538-5.538-5.538l0,0h-63.073
      c-3.041,0-5.507,2.466-5.507,5.507c0,0.01,0,0.021,0,0.031v56.181C410.805,226.443,413.271,228.909,416.312,228.909"></path>
  </svg></p>

<h2 id="docker和vagrant">Docker和Vagrant</h2>

<p><img src="/images/docker_vm.png" alt="docker-vm" /></p>

<p><img src="/images/docker_lxc.png" alt="docker-lxc" /></p>

<p><code>Docker</code> 与我之前尝试的 <a href="/2015/12/20/vagrant-note/">用Vagrant搭建跨平台ubuntu开发环境</a> 最大的不同的是，Docker容器是运行于操作系统层上，它是轻量级的，而vagrant属于虚拟机管理工具，依赖 <code>virtualbox/vmware/hyper-v</code> 等，在建立多个示例上和分布式微服务系统架构，比如云服务平台下，Docker无疑更节省资源切便捷。</p>

<h2 id="docker化php">Docker化PHP</h2>

<p>最近几天心血来潮，趁着有时间研究了下Docker，决定动手搭建一个基于Docker搭建的PHP环境。</p>

<h3 id="准备">准备</h3>

<p>首先我们需要确定的几个需求：</p>

<ul>
<li>php: 7.2.1 且安装常见扩展：swoole、GD、memcached、redis、mongodb、xdebug等</li>
<li>nginx 最新稳定版</li>
<li>mongo3.4</li>
</ul>

<h3 id="安装">安装</h3>

<p>为了方便快速搭建docker环境，我准备了一个脚本，以<code>ubuntu16.04</code>为基础：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span><span style="color:#75715e"># ubuntu中文源</span>
sed -i <span style="color:#e6db74">&#39;s/archive.ubuntu.com/mirrors.163.com/g&#39;</span> /etc/apt/sources.list
sed -i <span style="color:#e6db74">&#39;s/security.ubuntu.com/mirrors.163.com/g&#39;</span> /etc/apt/sources.list
sudo apt update <span style="color:#f92672">&amp;&amp;</span> sudo apt upgrade -y
sudo apt autoremove -y
<span style="color:#75715e"># 修改时区</span>
sudo cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
echo Asia/Shanghai | sudo tee /etc/timezone
sudo apt install zsh lrzsz screenfetch curl -y
<span style="color:#75715e"># 配置zsh 安装当前用户 所以不加sudo</span>
sh -c <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
chsh -s <span style="color:#66d9ef">$(</span>which zsh<span style="color:#66d9ef">)</span>
<span style="color:#75715e"># 安装docker docker-compose</span>
curl -fsSL get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker ubuntu
<span style="color:#75715e"># 配置docker国内mirror，可以使用Daocloud、灵雀云等镜像加速服务</span>
curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://xxxxxx.m.daocloud.io
sudo service docker restart
sudo curl -L https://github.com/docker/compose/releases/download/1.18.0/docker-compose-<span style="color:#e6db74">`</span>uname -s<span style="color:#e6db74">`</span>-<span style="color:#e6db74">`</span>uname -m<span style="color:#e6db74">`</span> -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose</code></pre></div>
<h3 id="镜像">镜像</h3>

<p><code>Nginx</code>和<code>mongo</code>可以直接使用<a href="https://hub.docker.com">dockerhub镜像仓库</a>上开箱即用的镜像，比如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ docker run --rm -p <span style="color:#ae81ff">80</span>:80 --name php-nginx -d nginx:1.12.2-alpine</code></pre></div>
<p>到了PHP这里，需要满足自己的需求，可以使用 <code>dockerfile</code> 文件构建自己的镜像，这里我使用基于官方<code>php:fpm</code>镜像，额外安装想要的扩展。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> php:fpm</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>LABEL maintainer<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;opso &lt;945206413@qq.com&gt;&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span><span style="color:#e6db74"> TIMEZONE Asia/Shanghai</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span><span style="color:#e6db74"> SWOOLE_VERSION 4.0.3</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># replace sources.list</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> sed -i <span style="color:#e6db74">&#39;s/deb.debian.org/mirrors.163.com/g&#39;</span> /etc/apt/sources.list <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> sed -i <span style="color:#e6db74">&#39;s/security.debian.org/mirrors.163.com/g&#39;</span> /etc/apt/sources.list <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> cp /usr/share/zoneinfo/<span style="color:#e6db74">${</span>TIMEZONE<span style="color:#e6db74">}</span> /etc/localtime <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>TIMEZONE<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> &gt; /etc/timezone<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># init</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get update <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    apt-get install -y --no-install-recommends <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    curl <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    wget <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    zip <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    git <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    unzip <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    procps <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libz-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libpq-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libjpeg-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libpng-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libfreetype6-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libssl-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libmcrypt-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libmemcached-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    apt-utils <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># install hiredis</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> wget https://github.com/redis/hiredis/archive/v0.13.3.tar.gz -O hiredis.tar.gz <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> mkdir -p hiredis <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> tar -xf hiredis.tar.gz -C hiredis --strip-components<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> rm hiredis.tar.gz <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">(</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        cd hiredis <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#f92672">&amp;&amp;</span> make -j<span style="color:#66d9ef">$(</span>nproc<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#f92672">&amp;&amp;</span> make install <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#f92672">&amp;&amp;</span> ldconfig <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">)</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> rm -r hiredis<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># install php extentions</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> pecl channel-update pecl.php.net <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> docker-php-ext-configure gd <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --enable-gd-native-ttf <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --with-jpeg-dir<span style="color:#f92672">=</span>/usr/lib <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --with-freetype-dir<span style="color:#f92672">=</span>/usr/include/freetype2 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> docker-php-ext-install -j<span style="color:#66d9ef">$(</span>nproc<span style="color:#66d9ef">)</span> bcmath mysqli pdo_mysql gd <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> pecl install mongodb <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> docker-php-ext-enable mongodb <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> pecl install memcached <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> docker-php-ext-enable memcached <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> pecl install redis <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> docker-php-ext-enable redis <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> pecl clear-cache<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># install swoole extention</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> wget https://github.com/swoole/swoole-src/archive/v<span style="color:#e6db74">${</span>SWOOLE_VERSION<span style="color:#e6db74">}</span>.tar.gz -O swoole.tar.gz <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> mkdir -p swoole <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> tar -xf swoole.tar.gz -C swoole --strip-components<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> rm swoole.tar.gz <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">(</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        cd swoole <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#f92672">&amp;&amp;</span> phpize <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#f92672">&amp;&amp;</span> ./configure --enable-async-redis --enable-mysqlnd --enable-coroutine --enable-openssl <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#f92672">&amp;&amp;</span> make -j<span style="color:#66d9ef">$(</span>nproc<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#f92672">&amp;&amp;</span> make install <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">)</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> rm -r swoole <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> docker-php-ext-enable swoole<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># install composer</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> curl -sS https://install.phpcomposer.com/installer | php <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> mv composer.phar /usr/local/bin/composer <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> composer config -g repositories.packagist composer https://packagist.phpcomposer.com <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> composer self-update --clean-backups<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 9000</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span><span style="color:#e6db74"> [&#34;php-fpm&#34;]</span></code></pre></div>
<h3 id="docker-compose">docker-compose</h3>

<p>为了方便将<code>nginx</code>、<code>php</code>、<code>mongo</code>环境组成一个集群，便于管理和文件共享，这里推荐使用<code>docker-compose</code>工具，配置也只需一个文件： <code>docker-compose.yaml</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># 注意这里的vertion是docker-compose yaml格式的version 不同的version支持不同的语法</span>
version: <span style="color:#e6db74">&#39;3&#39;</span>
services:
    nginx:
        <span style="color:#75715e"># 依赖关系 先跑php</span>
        depends_on:
            - <span style="color:#e6db74">&#34;php&#34;</span>
        image: <span style="color:#e6db74">&#34;nginx:1.12.2-alpine&#34;</span>
        <span style="color:#75715e"># 数据卷</span>
        volumes:
            - <span style="color:#e6db74">&#34;$PWD/conf.d:/etc/nginx/conf.d&#34;</span>
            - <span style="color:#e6db74">&#34;$PWD/www:/usr/share/nginx/html&#34;</span>
        <span style="color:#75715e"># 端口映射</span>
        ports:
            - <span style="color:#e6db74">&#34;80:80&#34;</span>
        <span style="color:#75715e"># 容器名称</span>
        container_name: <span style="color:#e6db74">&#34;compose-nginx&#34;</span>
    php:
        build: php/
        volumes:
            - <span style="color:#e6db74">&#34;$PWD/www:/var/www/html&#34;</span>
        container_name: <span style="color:#e6db74">&#34;compose-php&#34;</span>
    mongo:
        image: <span style="color:#e6db74">&#34;mongo:3.4.11&#34;</span>
        volumes: 
            - <span style="color:#e6db74">&#34;/data/mongodb:/data/db&#34;</span>
        ports: 
            - <span style="color:#e6db74">&#34;27017:27017&#34;</span>
        container_name: <span style="color:#e6db74">&#34;compose-mongo&#34;</span></code></pre></div>
<p>在命令行下运行：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker-compose build
$ docker-compose up -d</code></pre></div>
<p>由于我的是在vagrant虚拟机上安装的docker环境，然后就可以去局域网上看到phpinfo了~</p>

<p>代码我已经提交到我的github上了：<a href="https://github.com/opso-code/docker-php.git">opso-code/docker-php</a></p>

<h3 id="参考资料">参考资料</h3>

<p><a href="https://yeasy.gitbooks.io/docker_practice/content/install/ubuntu.html">Docker——从入门到实践</a></p>

<p><a href="http://blog.ideasriver.com/dockerizing-php-env/">Docker化PHP环境</a></p>

<p><a href="https://segmentfault.com/a/1190000007873815">Docker 实践（八）：构建 Laravel 开发环境</a></p></article>
    <footer class="post-footer">
      
      <ul class="post-tags">
        
          <li><a href="/tags/docker"><span class="tag">Docker</span></a></li>
        
          <li><a href="/tags/php"><span class="tag">Php</span></a></li>
        
      </ul>
      
      <p class="post-copyright">
        © This post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License，please give source if you wish to quote or reproduce.This post was published <strong>353</strong> days ago, content in the post may be inaccurate, even wrong now, please take risk yourself.
      </p>
    </footer>
    
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "blog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
    
  </section>
  
<footer class="site-footer">
  <p>© 2017-2019 opso&#39;s Blog</p>
  <p>Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> with theme <a href="https://github.com/laozhu/hugo-nuo" target="_blank" rel="noopener">Nuo</a>.</p>
  
</footer>


<script src="https://cdn.jsdelivr.net/npm/smooth-scroll@15.0.0/dist/smooth-scroll.min.js"></script>



<script async src="https://cdn.jsdelivr.net/npm/video.js@7.3.0/dist/video.min.js"></script>




<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    },
  });
</script>
<script type="text/x-mathjax-config">
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script>



<script src="/scripts/index.min.js"></script>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('\/service-worker.js').then(function() {
      console.log('[ServiceWorker] Registered');
    });
  }
</script>






<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?6b465630c0fa541cd6b4a9ce07137d82";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>



  </body>
</html>
